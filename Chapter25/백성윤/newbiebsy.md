# Chapter25. 쓰레드

### 쓰레드란 ?
> 하나의 프로세스 내부에서 독립적으로 실행되는 하나의 작업 단위를 말한다.
> 
> - 한 프로세스 내에는 여러개의 쓰레드가 동시에 실행될 수 있다. (멀티 쓰레드)
> - 쓰레드는, 프로세스가 할당 받은 메모리 영역 내에서, 쓰레드끼리 Code/Data/Heap 영역을 공유하고, Stack 영역은 별도로 관리한다.
> - 기본적으로 하나의 프로세스가 생성되면 하나의 쓰레드가 같이 생성되며, 이를 메인 쓰레드라고 부른다. (메인 메소드에서 특별히 다른 쓰레드를 생성하지 않아도 JVM을 관리하기 위한 여러 쓰레드가 존재한다.)
> - 쓰레드는 경량 프로세스라고도 부른다.
> 
> JVM이 시작되면 자바 프로세스가 시작한다. 이 프로세스 안에서 여러 개의 쓰레드가 수행된다. 어떤 프로세스든 간에 쓰레드가 하나 이상 수행된다. (한 쓰레드가 여러 프로세스를 공유하는 일은 없다.)

### Runnable 인터페이스와 Thread 클래스
> 쓰레드를 생성하는 것은 두 가지 방법이 있다. 하나는 Runnable 인터페이스를 구현하는 것이고, 다른 하나는 Thread 클래스를 확장하는 것이다.
> 두 가지 방법을 제공하는 이유는  자바는 다중 상속이 불가능하기 때문이다.   
> 
> 쓰레드를 생성할 때 알아야하는 특징은 아래와 같다.
> 
> - 쓰레드가 수행되는 메소드는 run() 메소드이다.
> - 쓰레드를 시작하는 메소드는 start() 이다.
>
> 다시 말해서 두 가지 방법 중 어떤 것을 선택하더라도, run() 메소드를 시작점으로 작성해야 하고, start() 메소드를 이용하여 쓰레드를 시작하는 것이다.
> 
> 새로 생성한 쓰레드는 run() 메소드가 종료되면 끝난다. 만약 run() 메소드가 끝나지 않으면, 실행한 애플리케이션은 끝나지 않는다. (데몬 쓰레드는 제외이다.)

### sleep() 메소드
> 쓰레드 클래스에 static 메소드는 대부분 해당 쓰레드를 위해 존재하는 것이 아니라, JVM에 있는 쓰레드를 관리하기 위한 용도이다.   
> 물론 예외도 있는데, 그 중 하나가 sleep() 메소드다.   
> 
| 리턴 타입        | 메소드 이름 및 매개 변수                | 설명                                                               |
|--------------|-------------------------------|------------------------------------------------------------------|
| static void  | sleep(long millis)            | 매개 변수로 넘어온 시간(1/1,000초)만큼 대기한다.                                  |
| static void | sleep(long millis, int nanos) | 첫 번째 매개변수로 넘어온 시간 + 두번째 매개 변수로 넘어온 시간(1/1,000,000,000초) 만큼 대기한다. |

> sleep() 메소드를 사용할 때는 항상 try-catch문을 사용해야 한다. 왜냐하면, sleep()는 InterruptedException 을 던질 수도 있다고 선언 되어 있기 때문이다.   
> 
> main() 메소드나, 다른 메소드에서 시작한 쓰레드가 종료하지 않으면 해당하는 자바 프로세스는 끝나지 않는다. (데몬 쓰레드는 예외이다.)

### 데몬 쓰레드란 ? 
> 쓰레드 클래스의 setDaemon(boolean on) 메소드를 이용하여 쓰레드 객체를 데몬 쓰레드로 지정할 수 있다. (쓰레드가 수행하기 전에 지정해야만 한다.)      
> 데몬 쓰레드는 해당 쓰레드가 종료되지 않아도, 다른 실행중인 일반 쓰레드가 없다면 종료된다. 

### synchronized
> 쓰레드와 synchronized는 뗄레야 뗄 수 없는 관계이다. 어떤 클래스나 메소드가 쓰레드에 안전하려면, synchronized를 사용해야만 한다.   
> 여러 쓰레드가 한 객체에 인스턴스 변수를 동시에 수정하려고 한다면 값이 꼬이는 경우가 발생할 수 있다. (매개변수나, 메소드에서만 사용하는 지역변수만 다루는 메소드에서는 synchronized로 선언할 필요가 없다.)   
> 
> synchronized는 두 가지 방법으로 사용할 수 있다.
> - 메소드 자체를 synchronized로 선언하는 방법(synchronized methods)
> - 다른 하나는 메소드 내의 특정 문장만 synchronized로 감싸는 방법(synchronized statements)
>
> synchronized는 여러 쓰레드에서 하나의 객체에 있는 인스턴스 변수를 동시에 처리할 때 발생하는 문제를 해결하기 위해서 필요한 것이다.
> 즉, 인스턴스 변수가 선언되어 있다고 하더라도, 다른 쓰레드에서 공유할 일이 없다면 synchronized를 사용할 이유가 없다.

### 쓰레드를 통제하는 메소드들
> 쓰레드를 통제해야 하는 경우가 있다면 아래의 메소드를 살펴보자.
> 
| 리턴 타입        | 메소드 이름 및 매개 변수               | 설명                                                                         |
|--------------|------------------------------|----------------------------------------------------------------------------|
| Thread.State | getState()                   | 쓰레드의 현재 상태를 반환하는 메소드                                                       |
| void         | join()                       | 수행중인 쓰레드가 중지할 때까지 기다린다. 쓰레드의 수행이 중지되면 join() 다음 라인에 있는 코드를 실행한다.           |
| void         | join(long millis)            | 매개 변수에 지정된 시간만큼(1/1,000초) 대기한다.                                            |
| void         | join(long millis, int nanos) | 첫 번째 매개 변수에 지정된 시간 (1/1,000초) + 두번째 매개변수에 지정된 시간(1/1,000,000,000초)만큼 대기한다. |
| void         | interrupt()                  | 수행중인 쓰레드에 중지 요청을 한다.                                                       |

> 쓰레드 클래스에는 State 라는 enum 클래스가 있다. 이 클래스에 선언되어 있는 상수들의 목록은 다음과 같다.

| 상태            | 의미                                                 |
|---------------|----------------------------------------------------|
| NEW           | 쓰레드 객체는 생성되었지만, 아직 시작되지는 않은 상태                     |
| RUNNABLE      | 쓰레드가 실행중인 상태                                       |
| BLOCKED       | 쓰레드가 실행 중지 상태이며, 모니터 락(monitor lock)이 풀리기를 기다리는 상태 |
| WAITING       | 쓰레드가 대기중인 상태                                       |
| TIMED_WAITING | 특정 시만만큼 쓰레드가 대기중인 상태                               |
| TERMINATED    | 쓰레드가 종료된 상태                                        |
> 이 클래스는 public static으로 선언되어 있다. 다시 말해서 Thread.State.NEW 와 같이 사용할 수 있따는 의미다.
> 그리고, 어떤 쓰레드이건 간에 "NEW -> 상태 -> TERMINATED"의 라이프 사이클을 가진다. 

### ThreadGroup에서 제공하는 메소드들
> ThreadGroup은 쓰레드의 관리를 용이하게 하기 위한 클래스이다. 쓰레드 그룹은 기본적으로 트리 구조를 가진다. ThreadGroup 용도가 다른 여러 쓰레드를 관리하기 위함이다.
> 
> ThreadGroup 클래스에서 제공하는 주요 메소드는 아래와 같다.
> - activeCount() : 실행중인 쓰레드의 개수를 리턴한다.
> - activeGroupCount() : 실행중인 쓰레드 그룹의 개수를 리턴한다.
> - enumerate(Thread[] list) : 현재 쓰레드 그룹에 있는 모든 쓰레드를 매개 변수로 넘어온 쓰레드 배열에 담는다.
> - enumerate(Thread[] list, boolean recurse) : 현재 쓰레드 그룹에 있는 모든 쓰레드를 매개 변수로 넘어온 쓰레드 배열에 담는다. 두 번째 매개 변수가 true 이면 하위에 있는 쓰레드 그룹에 있는 쓰레드 목록도 포함한다.
> - getName() : 쓰레드 그룹의 이름을 리턴한다.
> - getParent() : 부모 쓰레드 그룹을 리턴한다.
> - list() : 쓰레드 그룹의 상세 정보를 출력한다.
> - setDaemon(boolean daemon) : 지금 쓰레드 그룹에 속한 쓰레드들을 데몬으로 지정한다.



